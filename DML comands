-- Iniciando uma transação
BEGIN;

-- Inserindo produtos
INSERT INTO Produto (NumLote, NomeProd, CategoriaProd, DescricaoProd, DFabProd, DValProd, ValorVenda)
VALUES 
(1, 'Produto A', 'Categoria X', 'Descrição do Produto A', '2023-01-01', '2024-01-01', 100.0),
(2, 'Produto B', 'Categoria Y', 'Descrição do Produto B', '2023-02-01', '2024-02-01', 150.0)
ON CONFLICT (IDProduto, NumLote) DO NOTHING;

-- Inserindo clientes
INSERT INTO Cliente (NomeCompletoCli, LogradouroCli, BairroCli, MunicipioCli, EstadoCli, CPF_Cli, NumCartao, DataValCar, CVC, NomeCar)
VALUES 
('João Silva', 'Rua A', 'Bairro B', 'Cidade C', 'Estado D', 12345678901, 1234567812345678, '2025-01-01', 123, 'João Silva'),
('Maria Souza', 'Rua B', 'Bairro C', 'Cidade D', 'Estado E', 23456789012, 2345678923456789, '2025-02-01', 456, 'Maria Souza')
ON CONFLICT (CPF_Cli) DO NOTHING;

-- Inserindo funcionários
INSERT INTO Funcionario (NomeCompFunc, CPFFunc, SalarioFunc)
VALUES 
('Carlos Lima', 34567890123, 3000.0),
('Ana Santos', 45678901234, 3500.0)
ON CONFLICT (CPFFunc) DO NOTHING;

-- Inserindo compras
INSERT INTO Compra (Data)
VALUES 
('2024-01-01 10:00:00'),
('2024-01-02 11:00:00')
ON CONFLICT (IDCompra) DO NOTHING;

-- Inserindo fornecedores
INSERT INTO Fornecedor (CNPJ, NomeFor)
VALUES 
(12345678000101, 'Fornecedor A'),
(23456789000102, 'Fornecedor B')
ON CONFLICT (CNPJ) DO NOTHING;

-- Commit da transação
COMMIT;

BEGIN;

-- Inserindo gerentes
INSERT INTO Gerente (IDFuncionario)
SELECT IDFuncionario FROM Funcionario WHERE NomeCompFunc = 'Carlos Lima'
ON CONFLICT (IDFuncionario) DO NOTHING;

-- Inserindo administradores
INSERT INTO Administrador (IDFuncionario)
SELECT IDFuncionario FROM Funcionario WHERE NomeCompFunc = 'Ana Santos'
ON CONFLICT (IDFuncionario) DO NOTHING;

-- Inserindo segurança
INSERT INTO Seguranca (IDFuncionario)
SELECT IDFuncionario FROM Funcionario WHERE NomeCompFunc = 'Carlos Lima'
ON CONFLICT (IDFuncionario) DO NOTHING;

-- Inserindo atendentes
INSERT INTO Atendente (IDFuncionario)
SELECT IDFuncionario FROM Funcionario WHERE NomeCompFunc = 'Ana Santos'
ON CONFLICT (IDFuncionario) DO NOTHING;

COMMIT;

BEGIN;

-- Associando produtos a compras (Possui)
INSERT INTO Possui (QtdCompra, IDCompra, IDProduto, NumLote)
VALUES 
(10, 1, 1, 1),
(5, 1, 2, 2),
(2, 2, 1, 1)
ON CONFLICT (IDCompra, IDProduto, NumLote) DO NOTHING;

-- Inserindo fornecimentos (Fornece)
INSERT INTO Fornece (QtdFornecida, ValorCompra, CNPJ, IDProduto, NumLote)
VALUES 
(20, 2000.0, 12345678000101, 1, 1),
(15, 2250.0, 23456789000102, 2, 2)
ON CONFLICT (CNPJ, IDProduto, NumLote) DO NOTHING;

-- Associando funcionários a fornecedores (Contata)
INSERT INTO Contata (IDFuncionario, CNPJ)
SELECT f.IDFuncionario, s.CNPJ
FROM Funcionario f, Fornecedor s
WHERE f.NomeCompFunc = 'Ana Santos' AND s.NomeFor = 'Fornecedor A'
ON CONFLICT (IDFuncionario, CNPJ) DO NOTHING;

-- Associando funcionários a compras (Auxilia)
INSERT INTO Auxilia (IDCompra, IDFuncionario)
SELECT c.IDCompra, f.IDFuncionario
FROM Compra c, Funcionario f
WHERE c.IDCompra = 1 AND f.NomeCompFunc = 'Carlos Lima'
ON CONFLICT (IDCompra, IDFuncionario) DO NOTHING;

-- Validando produtos (Reconhece)
INSERT INTO Reconhece (IDProduto, NumLote, IDValidacao)
VALUES 
(1, 1, 1),
(2, 2, 2)
ON CONFLICT (IDProduto, NumLote, IDValidacao) DO NOTHING;

-- Validando compras (Valida)
INSERT INTO Valida (IDValidacao, IDCompra)
VALUES 
(1, 1),
(2, 2)
ON CONFLICT (IDValidacao, IDCompra) DO NOTHING;

-- Associando clientes a compras (Realiza)
INSERT INTO Realiza (IDCompra, IDCliente)
SELECT 1, c.IDCliente FROM Cliente c WHERE c.NomeCompletoCli = 'João Silva'
ON CONFLICT (IDCompra, IDCliente) DO NOTHING;

COMMIT;

-- Atualizando o nome e a descrição do produto
UPDATE Produto
SET NomeProd = 'Produto A+',
    DescricaoProd = 'Descrição atualizada do Produto A+'
WHERE IDProduto = 1 AND NumLote = 1;

-- Atualizando o salário de um funcionário
UPDATE Funcionario
SET SalarioFunc = 3200.0
WHERE NomeCompFunc = 'Carlos Lima';

-- Deletando um produto
DELETE FROM Produto
WHERE IDProduto = 2 AND NumLote = 2;

-- Deletando um cliente
DELETE FROM Cliente
WHERE CPF_Cli = 23456789012;

-- Selecionando todos os produtos
SELECT * FROM Produto;

-- Selecionando todas as compras
SELECT * FROM Compra;

-- Selecionando informações de um cliente específico
SELECT * FROM Cliente
WHERE NomeCompletoCli = 'João Silva';

-- Selecionando produtos fornecidos por um fornecedor específico
SELECT p.*
FROM Produto p
JOIN Fornece f ON p.IDProduto = f.IDProduto AND p.NumLote = f.NumLote
WHERE f.CNPJ = 12345678000101;

-- Selecionando todas as compras realizadas por um cliente específico
SELECT c.*
FROM Compra c
JOIN Realiza r ON c.IDCompra = r.IDCompra
WHERE r.IDCliente = (SELECT IDCliente FROM Cliente WHERE NomeCompletoCli = 'João Silva');

-- Selecionando todos os funcionários que são administradores
SELECT f.*
FROM Funcionario f
JOIN Administrador a ON f.IDFuncionario = a.IDFuncionario;
